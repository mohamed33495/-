<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#334155">
    <title>Ø§Ù„Ø´Ø­Ù†Ø§Øª | Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 h-screen flex flex-col overflow-hidden selection:bg-slate-300">

    <div class="fixed top-0 left-0 w-full h-40 bg-slate-700 rounded-b-[2.5rem] z-0 shadow-lg"></div>

    <div class="relative z-10 flex-1 overflow-y-auto pb-28 no-scrollbar">

        <header class="px-6 pt-10 pb-4 text-white">
            <h1 class="text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø´Ø­Ù†Ø§Øª ğŸ“¦</h1>
            <div class="relative mt-4">
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ØŒ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..."
                    class="w-full h-12 px-4 rounded-xl bg-slate-600/50 border border-slate-500/50 text-white placeholder-slate-300 focus:bg-slate-600 transition outline-none text-sm">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-4 text-slate-300"></i>
            </div>
        </header>

        <main class="px-4 mt-4 space-y-3">

            <div id="shipmentsList" class="space-y-3">
                <div class="text-center py-10 opacity-60">
                    <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                    <p class="text-slate-500 text-sm">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©...</p>
                </div>
            </div>

        </main>
    </div>

    <!-- Nav -->
    <nav
        class="fixed bottom-6 left-4 right-4 bg-slate-800/95 backdrop-blur-xl border border-white/10 shadow-2xl rounded-2xl flex justify-around items-center py-3 z-50">
        <a href="admin-panel.html"
            class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition group"><i
                class="fa-solid fa-gauge-high text-xl group-active:scale-90 transition"></i></a>
        <a href="#" class="flex flex-col items-center gap-1 text-white transition group relative">
            <i class="fa-solid fa-satellite-dish text-xl animate-pulse"></i>
            <span class="absolute -bottom-2 w-1 h-1 bg-white rounded-full"></span>
        </a>
        <div class="relative -top-8"><button
                class="bg-blue-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg shadow-blue-500/40 border-4 border-gray-100 transform active:scale-90 transition"><i
                    class="fa-solid fa-plus text-2xl"></i></button></div>
        <a href="admin-drivers.html"
            class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition group"><i
                class="fa-solid fa-motorcycle text-xl group-active:scale-90 transition"></i></a>
        <a href="admin-menu.html"
            class="flex flex-col items-center gap-1 text-slate-400 hover:text-white transition group"><i
                class="fa-solid fa-bars text-xl group-active:scale-90 transition"></i></a>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchShipments();
            setInterval(fetchShipments, 10000); // Poll every 10 seconds for "Live" updates
        });

        async function fetchShipments() {
            try {
                const res = await fetch('http://localhost:3000/api/admin/all-shipments');
                const data = await res.json();

                const container = document.getElementById('shipmentsList');

                if (!data.success || data.shipments.length === 0) {
                    container.innerHTML = '<div class="text-center py-10 opacity-50"><i class="fa-solid fa-box-open text-4xl mb-2"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø­Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p></div>';
                    return;
                }

                // If we have data, render it. 
                // Note: In a production app, we would diff the DOM to avoid flickering, 
                // but for this MVP, full re-render is acceptable for < 100 items.
                container.innerHTML = data.shipments.map(s => {
                    // Styles based on status
                    let statusColor = 'bg-gray-100 text-gray-600';
                    let icon = 'fa-box';

                    if (s.status === 'Pending') { statusColor = 'bg-slate-100 text-slate-600'; icon = 'fa-clock'; }
                    else if (s.status === 'OutForDelivery') { statusColor = 'bg-orange-50 text-orange-600'; icon = 'fa-truck-fast'; }
                    else if (s.status === 'Delivered') { statusColor = 'bg-green-50 text-green-600'; icon = 'fa-check'; }
                    else if (['Failed', 'Returned', 'Cancelled'].includes(s.status)) { statusColor = 'bg-red-50 text-red-600'; icon = 'fa-triangle-exclamation'; }

                    const driverText = s.driver_name ? `Ù…Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚: ${s.driver_name}` : 'ØºÙŠØ± Ù…Ø¹ÙŠÙ† Ù„Ø³Ø§Ø¦Ù‚';
                    const clientText = s.client_name || 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

                    return `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 group active:scale-[0.99] transition animate-fade-in">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 ${statusColor.split(' ')[0]} ${statusColor.split(' ')[1]} rounded-xl flex items-center justify-center font-bold text-lg">
                                    <i class="fa-solid ${icon}"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm text-gray-800">#${s.shipment_id}</h4>
                                    <p class="text-[10px] text-gray-400 font-bold">${clientText}</p>
                                </div>
                            </div>
                            <span class="text-[10px] bg-gray-100 px-2 py-1 rounded text-gray-500 font-mono">${new Date(s.creation_date).toLocaleDateString()}</span>
                        </div>
                        
                        <div class="flex items-center justify-between text-xs bg-gray-50 p-2 rounded-lg border border-gray-100 mb-3">
                            <span class="text-gray-500">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                            <span class="font-bold border-b border-dashed border-gray-300 pb-0.5">${s.status}</span>
                        </div>

                        ${s.driver_name ? `
                        <div class="flex items-center gap-2 mb-3 text-[10px] text-blue-600 bg-blue-50 px-2 py-1.5 rounded-lg w-fit">
                            <i class="fa-solid fa-steering-wheel"></i> ${s.driver_name}
                        </div>` : ''}

                        <div class="grid grid-cols-2 gap-2">
                             <button class="py-2.5 bg-slate-800 text-white rounded-xl text-xs font-bold shadow-lg shadow-slate-200 active:scale-95 transition">Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
                             <button class="py-2.5 border border-slate-200 text-slate-600 rounded-xl text-xs font-bold active:scale-95 transition">ØªØ¹Ø¯ÙŠÙ„</button>
                        </div>
                    </div>
                    `;
                }).join('');

            } catch (e) {
                console.error(e);
                // Don't overwrite with error on polling failure
                if (!document.getElementById('shipmentsList').innerHTML.includes('white')) {
                    document.getElementById('shipmentsList').innerHTML = '<p class="text-red-500 text-center">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>';
                }
            }
        }
    </script>

</body>

</html>
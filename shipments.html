<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Ø´Ø­Ù†Ø§ØªÙŠ | Ø´Ø­Ù†ØªÙŠ</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 h-screen flex flex-col overflow-hidden selection:bg-indigo-200">

    <div class="fixed top-0 left-0 w-full h-40 bg-indigo-600 rounded-b-[2.5rem] z-0 shadow-lg"></div>

    <div class="relative z-10 flex-1 overflow-y-auto pb-28 no-scrollbar">

        <header class="px-6 pt-10 pb-2 flex justify-between items-center text-white mb-4">
            <div>
                <h1 class="text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø´Ø­Ù†Ø§Øª ğŸ“¦</h1>
                <p class="text-indigo-200 text-xs mt-1">ØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
            </div>
            <button class="bg-white/20 p-2 rounded-xl backdrop-blur-md hover:bg-white/30 transition">
                <i class="fa-solid fa-filter text-lg"></i>
            </button>
        </header>

        <div class="px-6 space-y-4 mb-6">

            <div class="relative shadow-lg rounded-2xl">
                <input type="text" placeholder="Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹..."
                    class="w-full h-12 pr-12 pl-4 rounded-2xl border-none focus:ring-2 focus:ring-indigo-500 text-sm shadow-sm bg-white text-gray-700">
                <div class="absolute top-0 right-0 h-12 w-12 flex items-center justify-center text-gray-400">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </div>
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
                <button
                    class="px-5 py-2 bg-indigo-600 text-white rounded-full text-xs font-bold shadow-md whitespace-nowrap border border-indigo-600 transition">Ø§Ù„ÙƒÙ„
                    (12)</button>
                <button
                    class="px-5 py-2 bg-white text-gray-500 rounded-full text-xs font-bold shadow-sm whitespace-nowrap border border-transparent hover:border-gray-200 transition">ÙÙŠ
                    Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (3)</button>
                <button
                    class="px-5 py-2 bg-white text-gray-500 rounded-full text-xs font-bold shadow-sm whitespace-nowrap border border-transparent hover:border-gray-200 transition">Ø¬Ø§Ø±ÙŠ
                    Ø§Ù„Ø´Ø­Ù† (2)</button>
                <button
                    class="px-5 py-2 bg-white text-gray-500 rounded-full text-xs font-bold shadow-sm whitespace-nowrap border border-transparent hover:border-gray-200 transition">ØªÙ…
                    Ø§Ù„ØªØ³Ù„ÙŠÙ… (7)</button>
            </div>
        </div>

        <main class="px-6 space-y-4" id="shipmentsList">
            <div class="text-center py-10 opacity-60">
                <i class="fa-solid fa-spinner fa-spin text-3xl mb-4 text-indigo-600"></i>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø´Ø­Ù†Ø§ØªÙƒ...</p>
            </div>
        </main>
    </div>

    <nav
        class="fixed bottom-6 left-4 right-4 bg-white/90 backdrop-blur-xl border border-white/20 shadow-[0_8px_30px_rgb(0,0,0,0.12)] rounded-2xl flex justify-around items-center py-3 z-50">

        <a href="dashboard.html"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-indigo-600 transition group">
            <i class="fa-solid fa-house text-xl group-active:scale-90 transition"></i>
        </a>

        <a href="shipments.html" class="flex flex-col items-center gap-1 text-indigo-600 transition group relative">
            <i class="fa-solid fa-box-open text-xl"></i>
            <span class="absolute -bottom-1.5 w-1 h-1 bg-indigo-600 rounded-full"></span>
        </a>

        <div class="relative -top-8">
            <a href="create-shipment.html"
                class="bg-indigo-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg shadow-indigo-500/40 border-4 border-gray-50 transform active:scale-90 transition">
                <i class="fa-solid fa-plus text-2xl"></i>
            </a>
        </div>

        <a href="wallet.html"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-indigo-600 transition group">
            <i class="fa-solid fa-wallet text-xl group-active:scale-90 transition"></i>
        </a>

        <a href="profile.html"
            class="flex flex-col items-center gap-1 text-gray-400 hover:text-indigo-600 transition group">
            <i class="fa-solid fa-user-gear text-xl group-active:scale-90 transition"></i>
        </a>

    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const userId = localStorage.getItem('userId');
            if (!userId) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/api/client/shipments?clientId=${userId}`);
                const data = await response.json();
                const container = document.getElementById('shipmentsList');

                if (data.success && data.shipments.length > 0) {
                    container.innerHTML = '';

                    // Calculate Counts
                    const stats = {
                        all: data.shipments.length,
                        warehouse: 0,
                        shipping: 0,
                        delivered: 0
                    };

                    data.shipments.forEach(s => {
                        if (s.status === 'Pending') stats.warehouse++;
                        else if (['PickedUp', 'InTransit', 'OutForDelivery'].includes(s.status)) stats.shipping++;
                        else if (s.status === 'Delivered') stats.delivered++;
                    });

                    // Update Filter Buttons (Order: All, Warehouse, Shipping, Delivered)
                    const buttons = document.querySelectorAll('.overflow-x-auto button');
                    if (buttons.length >= 4) {
                        buttons[0].textContent = `Ø§Ù„ÙƒÙ„ (${stats.all})`;
                        buttons[1].textContent = `ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (${stats.warehouse})`;
                        buttons[2].textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´Ø­Ù† (${stats.shipping})`;
                        buttons[3].textContent = `ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… (${stats.delivered})`;
                    }

                    data.shipments.forEach(ship => {
                        // Determine Style based on Status
                        let statusConfig = {
                            text: ship.status,
                            color: 'gray',
                            icon: 'fa-box',
                            barColor: 'bg-gray-400'
                        };

                        switch (ship.status) {
                            case 'Pending':
                                statusConfig = { text: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: 'orange', icon: 'fa-clock', barColor: 'bg-orange-500' };
                                break;
                            case 'PickedUp':
                            case 'InTransit':
                            case 'OutForDelivery':
                                statusConfig = { text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø´Ø­Ù†', color: 'blue', icon: 'fa-plane-up', barColor: 'bg-blue-500' };
                                break;
                            case 'Delivered':
                                statusConfig = { text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', color: 'green', icon: 'fa-check-circle', barColor: 'bg-green-500' };
                                break;
                            case 'Cancelled':
                            case 'Failed':
                                statusConfig = { text: 'Ù…Ù„ØºØ§Ø©/ÙØ´Ù„Øª', color: 'red', icon: 'fa-triangle-exclamation', barColor: 'bg-red-500' };
                                break;
                        }

                        // Tailwind Classes Construction
                        const bgLight = `bg-${statusConfig.color}-50`;
                        const textDark = `text-${statusConfig.color}-600`;
                        const textDarker = `text-${statusConfig.color}-700`;
                        const bgLightest = `bg-${statusConfig.color}-100`;

                        const html = `
                        <div onclick="window.location.href='package-details.html?id=${ship.shipment_id}'" 
                             class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 relative overflow-hidden group active:scale-[0.98] transition duration-200">
                            <div class="absolute right-0 top-0 bottom-0 w-1.5 ${statusConfig.barColor}"></div>
                            
                            <div class="flex justify-between items-start mb-3 pl-2">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 ${bgLight} ${textDark} rounded-xl flex items-center justify-center text-lg">
                                        <i class="fa-solid ${statusConfig.icon}"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-gray-800 text-sm">${ship.content_description || 'Ø´Ø­Ù†Ø©'}</h3>
                                        <p class="text-[10px] text-gray-400 font-mono mt-0.5">#${ship.shipment_id}</p>
                                    </div>
                                </div>
                                <span class="${bgLightest} ${textDarker} text-[10px] px-2.5 py-1 rounded-lg font-bold">${statusConfig.text}</span>
                            </div>

                            <div class="flex items-center justify-between text-xs text-gray-500 border-t border-gray-50 pt-3 mt-2 pl-2">
                                <div class="flex items-center gap-2">
                                    <i class="fa-solid fa-calendar-days text-gray-300"></i>
                                    <span>${new Date(ship.creation_date).toLocaleDateString('ar-LY')}</span>
                                </div>
                                <div class="flex items-center gap-4">
                                    <span class="font-bold text-gray-800">${ship.weight_kg} k.g</span>
                                    <span class="${textDark} font-bold flex items-center gap-1 group-hover:underline">
                                        Ø§Ù„ØªÙØ§ØµÙŠÙ„ <i class="fa-solid fa-chevron-left text-[8px]"></i>
                                    </span>
                                </div>
                            </div>
                        </div>`;

                        container.insertAdjacentHTML('beforeend', html);
                    });
                } else {
                    container.innerHTML = `
                        <div class="text-center py-10 opacity-60">
                            <i class="fa-solid fa-box-open text-4xl mb-4 text-gray-300"></i>
                            <p class="text-sm font-bold text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø­Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </div>`;
                }
            } catch (err) {
                console.error('Error fetching shipments:', err);
                document.getElementById('shipmentsList').innerHTML = '<p class="text-center text-red-500 mt-10">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>';
            }
        });
    </script>
</body>

</html>